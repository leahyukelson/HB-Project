{% extends 'base.html' %}
{% block content %}

{% if 'current_user' in session %}
    <h2>New Plan</h2>
    <form id="edit_user_plan" action="/edit-plan/{{plan.plan_id}}" method="POST"> 
      Plan name:<input type="text" id="plan_name" name="plan_name" value='{{plan.plan_name}}'><br>
      Event name:<input type="text" id="event_name" name="event_name" value='{{plan.event_name}}' required><br>
      Event Date:<input type="date" id="event_date" name="event_date" value='{{plan_date}}' required><br>
      Event Time:<input type="time" id="event_time" name="event_time"  value={{plan_time}} required><br>
      Event Location Name:<input type="text" id="autocomplete" name="location" value='{{plan.event_location}}'><br>
      Event Address:<input type="text" id="street_number" name="number" value='{{plan.event_address}}'><input type="text" id="route" name="street"><br>
      Event City:<input type="text" id="locality" name="city" value='{{plan.event_city}}' required>
      Event State:<input type="text" id="administrative_area_level_1" name="state" value={{plan.event_state}} required>
      Event Zip:<input type="text" id="postal_code" name="zipcode" value={{plan.event_zipcode}} required><br>
      <input type="submit" id="submit_button">
    </form>

{% else %}
    <a href="/login-form" class="btn btn-primary">Log In</a>
    <a href="/create-account" class="btn btn-primary">Create Account</a>
{% endif %}

<script src="https://code.jquery.com/jquery.js"></script>
<script>
var autocomplete;
var componentForm = {
  street_number: 'short_name',
  route: 'long_name',
  locality: 'long_name',
  administrative_area_level_1: 'short_name',
  postal_code: 'short_name'
};

function initAutocomplete() {
  // Create the autocomplete object, restricting the search to geographical
  // location types.
  autocomplete = new google.maps.places.Autocomplete((document.getElementById('autocomplete')),
      {types: ['establishment']});
  autocomplete.addListener('place_changed', fillInAddress);
}

function fillInAddress() {
  // Get the place details from the autocomplete object.
  var place = autocomplete.getPlace();

  for (var component in componentForm) {
    document.getElementById(component).value = '';
    document.getElementById(component).disabled = false;
  }

  // Get each component of the address from the place details
  // and fill the corresponding field on the form.
  for (var i = 0; i < place.address_components.length; i++) {
    var addressType = place.address_components[i].types[0];
    if (componentForm[addressType]) {
      var val = place.address_components[i][componentForm[addressType]];
      document.getElementById(addressType).value = val;
    }
  }
}

// Bias the autocomplete object to the user's geographical location,
// as supplied by the browser's 'navigator.geolocation' object.
function geolocate() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var geolocation = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };
      var circle = new google.maps.Circle({
        center: geolocation,
        radius: position.coords.accuracy
      });
      autocomplete.setBounds(circle.getBounds());
    });
  }
}

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4vEycjJ1g4LUHzhfZfi0qAfMlWt3jRX8&libraries=places&callback=initAutocomplete"
        async defer></script>


{% endblock %}